import pandas as pd
import matplotlib.pyplot as plt
import os;

# Read the CSV generated by your Java simulation
df = pd.read_csv('server_load_over_time.csv')

# Columns representing servers (assuming first column is 'time')
server_cols = df.columns[1:]

# Downsample: take every 100th snapshot
df_downsampled = df.iloc[::100, :]

# Optional smoothing: rolling average with window=3
df_smoothed = df_downsampled.copy()
df_smoothed[server_cols] = df_downsampled[server_cols].rolling(window=3, min_periods=1).mean()

# Plot
plt.figure(figsize=(12, 6))

# Use distinct solid colors
colors = ['tab:blue', 'tab:orange', 'tab:green', 'tab:red', 'tab:purple']

for i, server in enumerate(server_cols):
    plt.plot(df_smoothed['time'], df_smoothed[server],
             color=colors[i % len(colors)],
             linewidth=2,
             label=server)

plt.xlabel('Time')
plt.ylabel('Active Connections')
plt.title('Server Load Over Time - Weighted Distribution Algorithm')
plt.legend()
plt.grid(True, alpha=0.3)
plt.tight_layout()

# Determine the directory of this script
script_dir = os.path.dirname(os.path.abspath(__file__))

# Save the figure in the same folder as the script
plt.savefig(os.path.join(script_dir, "server_load_graph.png"), dpi=300, bbox_inches='tight')
plt.show()
